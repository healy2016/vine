{% load humanize %}
{% load avatar_tags %}
  <script>
    function expandReplyNew(id) {
      if (!$('#replyDivNew'+id).is(':visible')) {
        $('#replyDivNew'+id).show();
        $.get("/ajax/reply/comment/"+id, {})
        .done(function(data) {
          $('#repliesofNew'+id ).html(data);
        });
      } else {
        $('#replyDivNew'+id).hide();
      }
    }
    function replyNew(id) {
      var reply_str = $('#replyNew'+id).val();
      $.post("/ajax/reply/comment/"+id, {'reply_str':reply_str})
      .done(function(data) {
        $('#repliesofNew'+id ).html(data);
        $('#replyNew'+id).val('');
        var reply_num = $('#reply_comment_new'+id).find('span');
        var count = parseInt(reply_num.text())+1;
        reply_num.text(count);
      });
    }
  </script>

<div id="commet_new">  
    <fieldset>
      <legend>最新评论</legend>
        
        <div id="commetList_new">
            <ul class="list-group">
            {% for message in p_comment_new.object_list %}
                 <li class="list-group-item">
                     <a href="{{message.comment_board.url}}" target="_blank">
                       <span class="comment-text" id="comment_str_{{message.id}}">{{message.comment_str}}</span>
                   </a></br>
                    <strong>{% if message.author %}{{ message.author.user }}{% else %}{{ message.author_ip }}{% endif %}</strong>
                     <span>
                       <span class='comment-time'>于 {{ message.time_added|naturaltime }}</span>
                     </span>
                     <span style="float:right">
                      <a href="javascript:void(0);" id="up_comment_{{message.id}}" onclick="up('{{message.id}}');return false;">
                        {% if user.id in message.up_users %}
                        <i class="fa fa-thumbs-up"></i>
                        {% else %}
                        <i class="fa fa-thumbs-o-up"></i>
                        {% endif %}
                        +<span>{{ message.up_users|length }}</span>
                      </a>
                      {# TODO: 添加tips，说明icon功能，不然留言icon字太小。 #}
                      <a href="javascript:void(0);" id="reply_comment_new{{message.id}}" onclick="expandReplyNew('{{message.id}}');return false;">
                        <i class="fa fa-comments-o"></i>
                        <span>{{ message.replies|length }}</span>
                      </a>
                     </span>
                     <div id="detailDivNew{{message.id}}" style="display:none;margin-top:10px">
                     </div>

                     <div id="replyDivNew{{message.id}}" style="display:none;margin-top:10px">
                     <br>
                       <div id="repliesofNew{{message.id}}">
                       {% include 'reply.html' %}
                       </div>
                       <div name="reply{{message.id}}" class="input-group">
                         <textarea rows="5" style="width:100%;height:34px;resize:none" id="replyNew{{message.id}}" name="reply" placeholder="可输入5-140个字"></textarea>
                         <span class="input-group-btn">
                           <button class="btn btn-default submitComment" data-loading-text="回复中" onclick="replyNew('{{message.id}}')" type="button">回复</button>
                         </span>
                       </div><!-- /input-group -->
                     </div>
                     <br>
                  </li>
            {% endfor %}
            </ul>
        </div>
        
    </fieldset>
</div>
